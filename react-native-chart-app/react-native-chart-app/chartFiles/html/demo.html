<!DOCTYPE html>
<!--[if IE 8 ]><html class="ie8" lang="en-gb"> <![endif]-->
<!--[if IE 9 ]><html class="ie9" lang="en-gb"><![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en-gb">
<!--<![endif]-->
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.Â®js"></script>
<![endif]-->

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">

    <!-- css-->
    <link rel="stylesheet" href="../libs/jquery/jquery-ui.css">
    <link href="../release/css/x-chart-light-min.css" rel="stylesheet" type="text/css">
    <link href="../release/theme/infinit-light.css" rel="stylesheet" type="text/css">
    <title>Chart</title>

</head>
<body>

<!--Chart Container-->
<div id="mainchart"></div>


<!--Common Libs-->
<script src="../libs/jquery/jquery.js" type="text/javascript"></script>
<script src="../libs/jquery/jquery-ui.min.js" type="text/javascript"></script>
<script src="../libs/highcharts/highstock.js" type="text/javascript"></script>
<script src="../libs/highcharts/highcharts-more.js" type="text/javascript"></script>
<script src="../release/js/x-lib-light-min.js" type="text/javascript" ></script>
<!--Chart-->
<script src="../release/js/x-chart-min.js" type="text/javascript" ></script>
<script src="../theme/theme-light.js" type="text/javascript"></script>

<!--KeyCloak related js-->
<!--<script src="https://security-xinfinit.rhcloud.com/auth/js/keycloak.js"></script>-->
<!--<script src="../js/keycloakAdaptor.js"></script>-->

<script type="text/javascript">

    var chart;

    var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    };

    var initializeChart = function(container, properties) {
        try {
            infChart.staticMode = true;
            chart = infChart.manager.initChart(container, properties);

        } catch (err) {
            infUtil.console.log("Error in loading the chart." + err);
        }
    };

    $(document).ready(function() {
        var token = getUrlParameter('key');


                var symbol = getUrlParameter('sym');
                var desc = getUrlParameter('desc');
                var symbolType = getUrlParameter('ins');
                var dp = getUrlParameter('dp');

                var obj = {

                    settings:{
                        dataProvider : {
                            type : 'WEBFG', source : 'WEBFG', url : '/x-one-webfg/dataService/dataRequest?'
                            //type : 'infinit', source : 'SIX', url : '/rest/history/load?'
                        },
                        config:{
                            interval : 'D', // [T/D/W/M] - data interval
                            type : 'candlestick', // [candlestick/line/area/ohlc/hlc/column] - chart type
                            period : 'Y_3',    //  initial period (Y_1 - year , M_1 one month, I - intraday)
                            crosshair : 'all', // [last/all] - type of the cross hair (all - any place on y axis, last - close value on y axis)
                            yAxisType : 'normal',
                            minMax : false,   // [true/false] - to show/ hide min, max values initially
                            navigator : false  // [true/false] - to show/ hide history panel
                        },

                        lang :{
                            language: 'en', pathPrefix: "../js/lang"
                        },
                        symbol: {
                            symbol: 'YAHOO', symbolId: 'US9843321061_acciones_67_df', symbolDesc: 'YAHOO', symbolType: 'EQU', dp: 2

                        }
                    },
                    config:{
                        chart :{
                            "borderWidth": 0,
                            "lineWidth": 1.6
                        },
                        /* colors to be applied for different chart types */
                        plotOptions : {
                            candlestick : {
                                color: '#ff3000',
                                lineColor: '#bf1212',
                                upColor: '#52ac62',
                                upLineColor: '#438f50'

                            },
                            line : {
                                lineColor : '#fc5d31',
                                color : '#fc5d31'
                            },
                            ohlc : {
                                color : '#fc5d31'
                            },
                            area : {
                                color : '#fc5d31',
                                fillColor : {
                                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                                    stops: [
                                        [0, 'rgba(255,93,49,0.9)'],
                                        [1, 'rgba(177,55,11,0.2)']
                                    ]
                                }
                            },
                            column : {
                                color : '#fc5d31'
                            }
                        }
                    }
                };
                initializeChart( 'mainchart', obj);


        // set real-time data
        setInterval (function () {
            if (chart) {
                var last = (Math.random (1,100));
                var dateTime = new Date (Date.now());
                var symbolId = chart.symbol.symbolId;
                var symbol = chart.symbol.symbol;
                console.log ("dateTime:"+dateTime+ " | last:" + last);

                chart.addTick (
                        {
                            symbol : symbol,
                            symbolId : symbolId,
                            close : last*100,
                            dateTime : (new Date (Date.now())).getTime() ,
                            volume : 5000*(last)
                        }
                );
            }
        }, 1000);
    });
</script>





</body>
</html>